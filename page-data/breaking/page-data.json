{"componentChunkName":"component---src-components-blog-tsx","path":"/breaking/","result":{"data":{"markdownRemark":{"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When I work in the frontend, we can always release any change whenever we want (the only risk is that during the release, there might be several minutes when the server has to shift from the old version to the new version, but it's not a big problem at all)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"However, when I started to work in the backend, I noticed that changes could be breaking changes, and we cannot release them right away. So what are the breaking changes in that case, and why might they \"break\" something ?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Context"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 672px; "},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/19af9/1.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 41.07142857142857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKUlEQVR42m1S2XKDMAzM//9gU0pm2oFwGJ8yJunTVhIOmUzzsGAt2pUscbptGVshpBTgvYV3FjF6lDWhVF5igZwld80JITg4zpU30c6L10keZSVY5/DVtjifz5hno9zKcNaj63pchwHO74WIEoZx5NxPtJcLfPCvhhLkvCcSRRZlUPKKUnL9FvUtXa9sqlxirvIb+xyGD4hxcAsSV+y7H0Xiq07jVTu731b83otCzpJ/vz31bw1zjkf7B8czkm4l7rtvHsOsfAyWOfpvuIuizm3jK8rQhXssQGCXWbGYqZ4Ndz6oRrSie1mK46W0upQPGGOqUeTN8/X7HiMvIYRQCxKmaULTNKy5MP9mKYkHbO2ChSvHGLRIqbz3DoGRKq+/DceLmVVD9BzTH3oDYV5DJZxlAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"1","title":"","src":"/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/ff9d2/1.png","srcSet":["/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/0372f/1.png 168w","/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/2ec80/1.png 336w","/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/ff9d2/1.png 672w","/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/7b5cb/1.png 1008w","/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/275af/1.png 1344w","/site-v2.0/static/1df2348b3dff69ca72c1941c9cb9e528/19af9/1.png 1378w"],"sizes":"(max-width: 672px) 100vw, 672px","style":"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;","loading":"lazy","decoding":"async"},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Frontend (web/app) fetches data via API. API retrieves data from the database."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If an API changes (either response or payload), it may break the frontend, because the frontend still consumes the old API."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"When the api is used by app, we should take extra attention because we cannot modify the already installed apps (unless we force all the users to update their apps). It means the api should be "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"retrocompatible"}]},{"type":"text","value":" with old versions of apps, unless old versions of apps are all upgraded to the new version with the new API."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's go deeper into the subject for API and Database."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"RestAPI and Graphql"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The following changes will break the frontend if nothing is done in the frontend:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Add new required params / rename required params in request payload"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Remove a field which is being used from the response"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Rename a field which is being used from the response"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"As we can see, the only safe operation is to \"add\" a new field, which will break nothing, thus, when we want to update the name of a field, a common way to update a new field is to add a "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"fieldV2"}]},{"type":"text","value":" while deprecating the old field, and really deprecating the old field once it's not used in any frontends."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we want to remove a field, we should wait until it's not used in any apps."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If the payload has a breaking change, it's a bit complicated because we cannot release the backend and frontend at same time. In this case, it's better to create an \"apiV2\", release the new api, then implement the frontend to use the apiV2 and release the new frontend. Finally, if the old api is no longer used, we can remove it in the backend."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Database migration"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Database migration could bring breaking changes too. For example, when a column is renamed or removed, the interaction with the database might break the server because it cannot find the column."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"First of all, it's better to make the database migration and SQL interaction update separately. If we do PRs, it's better to create two separate PRs, one for database migration, another one for data infrastructure modification."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Then, if we want to rename a column, it's dangerous to rename it right away. Like what we do when we want to rename a field in API response, we could create another column, make the migration, fetch data from this column, and finally remove the old column."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we want to drop a column, we need to refactor the data infrastructure layer to remove the usage, before making the migration."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we need to create a new column, it's better to create the column with \"default null\", so the service will not throw errors when it fetches data."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Thanks for reading !"}]}],"data":{"quirksMode":false}},"frontmatter":{"title":"How to handle breaking change in API/Database","date":"18 October, 2023"}}},"pageContext":{"slug":"/breaking/"}},"staticQueryHashes":["2080627102","265798717"],"slicesMap":{}}