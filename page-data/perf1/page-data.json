{"componentChunkName":"component---src-components-blog-tsx","path":"/perf1/","result":{"data":{"markdownRemark":{"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With NextJS, it's not easy to detect if a piece of code (for example, lodash) is really included in the JS bundle for two reasons:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Code is fully uglified, including function names and variables, the implementation is changed a bit, too."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Real JS bundle per page is different from the bundle built from "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"next build"}]},{"type":"text","value":", because next.js chooses the small chunks and constructs the real JS bundle by page, so it's difficult to know if a built js chunk really exists in the real bundle or not."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"After hours of work, I found the most efficient way to detect if a library is loaded in the uglified js bundle or not:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"By error messages which are thrown"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Yes, it's the "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"only"}]},{"type":"text","value":" thing that will not be uglified."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Thus, I searched for lodash repo in git, and finally found a special thrown message from "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"template.js"}]},{"type":"text","value":": "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Invalid variable option passed into _.template"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With this error message, I was able to find that the whole lodashed is loaded from the 455KB bundle, while we didn't use this function in the source code."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"By the way, the fix was quite simple: import the lodash function by "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"import get from 'lodash/get'"}]},{"type":"text","value":", but not by "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"import {get} from 'lodash'"}]},{"type":"text","value":" and there will be only used lodash function loaded in the bundle."}]}],"data":{"quirksMode":false}},"frontmatter":{"title":"Improve Web Performance with example for next.js: how did I find lodash is loaded completely in the bundle","date":"28 January, 2023"}}},"pageContext":{"slug":"/perf1/"}},"staticQueryHashes":["2080627102","265798717"],"slicesMap":{}}