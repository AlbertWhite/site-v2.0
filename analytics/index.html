<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.82 'Merriweather',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Merriweather',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;color:hsla(0,0%,0%,0.9);font-family:'Merriweather Sans',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:2.25rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;color:hsla(0,0%,0%,0.9);font-family:'Merriweather Sans',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1.62671rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;color:hsla(0,0%,0%,0.9);font-family:'Merriweather Sans',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1.38316rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;color:hsla(0,0%,0%,0.9);font-family:'Merriweather Sans',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;color:hsla(0,0%,0%,0.9);font-family:'Merriweather Sans',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:0.85028rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;color:hsla(0,0%,0%,0.9);font-family:'Merriweather Sans',sans-serif;font-weight:800;text-rendering:optimizeLegibility;font-size:0.78405rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}ul{margin-left:1.82rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.82rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;font-size:0.85rem;line-height:1.82rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;font-size:1rem;line-height:1.82rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}blockquote{margin-left:0;margin-right:1.82rem;margin-top:0;padding-bottom:0;padding-left:2.0475rem;padding-right:0;padding-top:0;margin-bottom:1.82rem;font-size:1.17608rem;line-height:1.82rem;color:hsla(0,0%,0%,0.59);border-left:0.6825rem solid;border-color:hsla(0,0%,0%,0.1);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.82rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.82rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.82rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.82rem;margin-bottom:calc(1.82rem / 2);margin-top:calc(1.82rem / 2);}li > ul{margin-left:1.82rem;margin-bottom:calc(1.82rem / 2);margin-top:calc(1.82rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.82rem / 2);}code{font-size:0.85rem;line-height:1.82rem;}kbd{font-size:0.85rem;line-height:1.82rem;}samp{font-size:0.85rem;line-height:1.82rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.21333rem;padding-right:1.21333rem;padding-top:0.91rem;padding-bottom:calc(0.91rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}a{color:#375c85;text-decoration:none;box-shadow:0 1px 0 0 currentColor;}a:hover,a:active{box-shadow:none;}h1,h2,h3,h4,h5,h6{margin-top:3.64rem;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.82rem;color:hsla(0,0%,0%,0.8);font-weight:400;}blockquote cite:before{content:"â€” ";}@media only screen and (max-width:480px){blockquote{margin-left:-1.365rem;margin-right:0;border-left:0.34125rem solid;border-color:hsla(0,0%,0%,0.1);padding-left:1.02375rem;}}@media only screen and (max-width:768px){html{font-size:93.75%;line-height:27.35px;}}</style><meta name="generator" content="Gatsby 5.13.0"/><style data-href="/site-v2.0/styles.8986dcf88797311951de.css" data-identity="gatsby-global-css">body,html{min-height:100vh}html{--app-main-color:#639;align-items:center;background-color:#fff;margin:0 auto;max-width:672px;@media (max-width:768px){max-width:80%}}body.dark{background:#282c35;color:#fff}body.dark h2,body.dark h3,body.dark h4,body.dark p{color:#fff!important}body.dark a,body.dark a h3{color:#e0c1ff}body.dark a div{color:#fff}body.dark .filterContainer{background-color:#282c35}a{color:var(--app-main-color,#639);color:#639}a:hover{box-shadow:0 1px 0 0 currentColor}pre[class*=language-]{font-size:.8em!important;white-space:pre-wrap!important}.react-toggle--focus .react-toggle-thumb{box-shadow:none!important}.customToggle.react-toggle--checked .react-toggle-track,.customToggle.react-toggle--checked:hover:not(.react-toggle--disabled) .react-toggle-track{background-color:#639;background-color:var(--app-main-color,#639)}.gatsby-highlight pre[class*=language-].line-numbers{padding-left:2.8em}.gatsby-highlight{background-color:#fdf6e3;border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-].line-numbers{overflow:initial;padding:0 0 0 2.8em}code[class*=language-],pre[class*=language-]{word-wrap:normal;color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#073642}pre[class*=language-]{border-radius:.3em;margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{background:#eee8d5;color:#657b83}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}.react-toggle{-webkit-touch-callout:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent;background-color:transparent;border:0;cursor:pointer;display:inline-block;padding:0;position:relative;touch-action:pan-x;-webkit-user-select:none;user-select:none}.react-toggle-screenreader-only{clip:rect(0 0 0 0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.react-toggle--disabled{cursor:not-allowed;opacity:.5;transition:opacity .25s}.react-toggle-track{background-color:#4d4d4d;border-radius:30px;height:24px;padding:0;transition:all .2s ease;width:50px}.react-toggle:hover:not(.react-toggle--disabled) .react-toggle-track{background-color:#000}.react-toggle--checked .react-toggle-track{background-color:#19ab27}.react-toggle--checked:hover:not(.react-toggle--disabled) .react-toggle-track{background-color:#128d15}.react-toggle-track-check{bottom:0;height:10px;left:8px;line-height:0;margin-bottom:auto;margin-top:auto;opacity:0;position:absolute;top:0;transition:opacity .25s ease;width:14px}.react-toggle--checked .react-toggle-track-check,.react-toggle-track-x{opacity:1;transition:opacity .25s ease}.react-toggle-track-x{bottom:0;height:10px;line-height:0;margin-bottom:auto;margin-top:auto;position:absolute;right:10px;top:0;width:10px}.react-toggle--checked .react-toggle-track-x{opacity:0}.react-toggle-thumb{background-color:#fafafa;border:1px solid #4d4d4d;border-radius:50%;box-sizing:border-box;height:22px;left:1px;position:absolute;top:1px;transition:all .5s cubic-bezier(.23,1,.32,1) 0ms;transition:all .25s ease;width:22px}.react-toggle--checked .react-toggle-thumb{border-color:#19ab27;left:27px}.react-toggle--focus .react-toggle-thumb{box-shadow:0 0 2px 3px #0099e0}.react-toggle:active:not(.react-toggle--disabled) .react-toggle-thumb{box-shadow:0 0 5px 5px #0099e0}</style><link href="//fonts.googleapis.com/css?family=Merriweather+Sans:800|Merriweather:400,400i,700" rel="stylesheet" type="text/css"/><style data-styled="" data-styled-version="6.1.8">.iqYGQi{color:#663399;color:var(--app-main-color,#663399);}/*!sc*/
data-styled.g5[id="blog__StyledTitle-sc-1dnbuxy-0"]{content:"iqYGQi,"}/*!sc*/
.jHXVia{font-size:0.8rem;color:inherit;margin-bottom:2rem;}/*!sc*/
data-styled.g6[id="blog__StyledDate-sc-1dnbuxy-1"]{content:"jHXVia,"}/*!sc*/
.kwpZJy{margin:0 1rem;}/*!sc*/
data-styled.g7[id="blog__StyledDevider-sc-1dnbuxy-2"]{content:"kwpZJy,"}/*!sc*/
</style></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div id="anchor"><h2 class="blog__StyledTitle-sc-1dnbuxy-0 iqYGQi">Track web performance with Google Analytics</h2><div class="blog__StyledDate-sc-1dnbuxy-1 jHXVia">13 April, 2020</div><div><div><p>This is a research project for discovering the possibility of tracking web performances with Google Analytics. In this project, we have succeed with:</p>
<ul>
<li>Track Page Load Time and Transaction Time</li>
<li>Track User Event Response Time (For example, the time between clicking on the payment button until redirecting to the confirmation page)</li>
</ul>
<p><a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics">Here</a> is the project built with Next.js. I have created several <a href="https://web-perf-with-google-analytics.now.sh/">pages</a> to make test secenarios.</p>
<h3>1. Track Page Load Time</h3>
<h4>Description</h4>
<p>Normally Google analytics is used to user related information and serves in marketing purposes, such as page views, user regions, user behavoirs. However, Google analytics can also be used to track page loading time, and other timing related metrics.</p>
<p>Average page loading time is one of the default tracking metrics in Google analytics (GA for the following content). It is in Behavoir &gt; Site Speed &gt; Page Timing.</p>
<p>For example, there is a huge loop on the about page, GA can tell us by its longer loading time.</p>
<p><img src="https://raw.githubusercontent.com/AlbertWhite/WebPerf-with-Google-Analytics/master/images/1.png" alt=""/></p>
<p>If we choose &quot;Technical&quot; under the &quot;Explorer&quot; panel, we will have more valuable web perf metrics, for example, Redirection Time, Server response time.</p>
<p><img src="https://raw.githubusercontent.com/AlbertWhite/WebPerf-with-Google-Analytics/master/images/3.png" alt=""/></p>
<h4>Technology</h4>
<p>react-ga library</p>
<h4>Implementation</h4>
<p>Technically, we need to:</p>
<ol>
<li>Set up a google analytics account. Here is the official tutorial from Google analytics academy.</li>
<li>Put the tracking code and intializing script just after the opening  tag. If it is a react project, we can use the library <a href="https://github.com/react-ga/react-ga">react-ga</a> to help with intializing GA and tracking.</li>
<li>The intializing of google analytics should be done for every page, which means we can do it in Layout component or the Central Routing component. Here is the example how we are doing in this project:
In <a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics/blob/master/components/MyLayout.js">Layout Component</a>,</li>
</ol>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Layout</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span><span class="token constant">GA_INITIALIZED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">initGA</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      window<span class="token punctuation">.</span><span class="token constant">GA_INITIALIZED</span> <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token function">logPageView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">{</span>layoutStyle<span class="token punctuation">}</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Header <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">}</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>And in <a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics/blob/master/utils/analytics.js">utils</a>,</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">import</span> ReactGA <span class="token keyword">from</span> <span class="token string">&quot;react-ga&quot;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">initGA</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactGA<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token string">&quot;UA-xxxxxxx-x&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">gaOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">siteSpeedSampleRate</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token comment">// need to put 100 here to well track site speed</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">logPageView</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ReactGA<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">page</span><span class="token operator">:</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname <span class="token punctuation">}</span><span class="token punctuation">)</span>
  ReactGA<span class="token punctuation">.</span><span class="token function">pageview</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<h4>To be noticed</h4>
<p>There are points to be noticed:</p>
<ol>
<li>
<p>Remember to set siteSpeedSampleRate into 100 on intializing if there is not much traffic on the site If we don&#x27;t set siteSpeedSampleRate to 100 (100%), maybe there will be no data on site loading time. Because by default, GA tracks only 10% or fewer traffic for site speed.</p>
</li>
<li>
<p>Remember to modify the range of time if you want to see today&#x27;s traffic By default, the time range for reports (Audience, Acquisition, Behavoir) are until yesterday. We can modify the time range and set &quot;Hourly&quot; if we want to see today&#x27;s traffic (useful for developing or debugging).</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/AlbertWhite/WebPerf-with-Google-Analytics/master/images/2.png" alt=""/></p>
<h4>Conclusion</h4>
<p>It is a good start point for measuring web perf, to know which page takes the longest time to load, and to know how it changes overtime.</p>
<h3>2. Track User Event Response Time</h3>
<h4>Description</h4>
<p>In order to track user interaction response time, we need the help of gtag.js or google tag manager.</p>
<p>In order to use gtag.js, the library react-ga is not a good idea, because it uses analytic.js, the old version of the script for google analytics, instead of gtag.js, a new version of the script for google analytics. Here is a good example for integrating gtag.js in a project of NextJs.</p>
<p>In order to track user interaction response time, the idea is simple:</p>
<ol>
<li>Get the timestamp when the interaction is triggered</li>
<li>Get the timestamp when the interaction is finished</li>
<li>Calculate the delta of two timestamp, push the data to google analytics</li>
</ol>
<h4>Technology</h4>
<ul>
<li>gtag.js</li>
<li>window.performance.timing API</li>
</ul>
<h4>Implementation</h4>
<ol>
<li>Implement GA tracking with gtag.js.
Here is the implementation for next.js in <a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics/blob/master/pages/_document.js">_document.js</a>.</li>
</ol>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">&lt;</span>Head<span class="token operator">&gt;</span>
  <span class="token punctuation">{</span><span class="token comment">/* Global Site Tag (gtag.js) - Google Analytics */</span><span class="token punctuation">}</span>
  <span class="token operator">&lt;</span>script
    <span class="token keyword">async</span>
    src<span class="token operator">=</span><span class="token punctuation">{</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://www.googletagmanager.com/gtag/js?id=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">GA_TRACKING_ID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>script
    dangerouslySetInnerHTML<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
      <span class="token literal-property property">__html</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag(&#x27;js&#x27;, new Date());
            gtag(&#x27;config&#x27;, &#x27;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">GA_TRACKING_ID</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&#x27;, {
              &#x27;sample_rate&#x27;: 100,
              &#x27;site_speed_sample_rate&#x27; : 100
            });
          </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Head<span class="token operator">&gt;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<ol start="2">
<li>
<p>Track time with gtag.</p>
<p><a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics/blob/master/pages/pay.js">Here</a> is an example for tracking the payment button.</p>
</li>
</ol>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">treatPayment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> setIsConfirmed <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> startTreatPaymentTime <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIsConfirmed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> endTreatPaymentTime <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> deltaTime <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>endTreatPaymentTime <span class="token operator">-</span> startTreatPaymentTime<span class="token punctuation">)</span>
    <span class="token function">trackEvent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;timing_complete&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;test_name&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">value</span><span class="token operator">:</span> deltaTime<span class="token punctuation">,</span>
      <span class="token literal-property property">event_category</span><span class="token operator">:</span> <span class="token string">&quot;payment_confirmation_time&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">999</span><span class="token punctuation">)</span> <span class="token comment">// mock 1s to treat payment</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>We will see the &#x27;payment_confirmation_time&#x27; is tracked in google analytics and the average time duration is 1s.</p>
<p><img src="https://raw.githubusercontent.com/AlbertWhite/WebPerf-with-Google-Analytics/master/images/4.png" alt=""/></p>
<h3>3. Create helper function for tracking user interaction response time</h3>
<p>If a user action concerns multiple pages, it is not easy to calculate delta time within one file. We need a helper function and save the timestamp data somewhere stable, for example, redux store, window object or cache.</p>
<p>In this project, I have create a helper function <a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics/blob/mastsr/utils/analytics.js">trackEventTiming</a>.</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">trackEventTiming</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">trackType</span><span class="token operator">:</span> <span class="token constant">TRACK_START</span> <span class="token operator">|</span> <span class="token constant">TRACK_END</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eventType</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">timeStamp</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>In this way, we can track the start time and end time for the same event, in whatever which page.</p>
<p>For using this function, in the file <a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics/blob/master/pages/pay-with-redirection.js">pay-with-redirection.js</a></p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">treatPayment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">router<span class="token punctuation">,</span> setIsConfirmed</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">trackEventTiming</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">trackType</span><span class="token operator">:</span> trackTypes<span class="token punctuation">.</span><span class="token constant">TRACK_START</span><span class="token punctuation">,</span>
    <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&quot;paymentWithRedirection&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timeStamp</span><span class="token operator">:</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">setIsConfirmed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    router<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1999</span><span class="token punctuation">)</span> <span class="token comment">// mock 1s to treat payment</span>
<span class="token punctuation">}</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p>Then on the <a href="https://github.com/AlbertWhite/WebPerf-with-Google-Analytics/blob/master/pages/index.js">index page</a>,</p>
<div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> paymentEventIndex <span class="token operator">=</span> window<span class="token punctuation">.</span>eventTimeStamps<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span>
    <span class="token parameter">event</span> <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>eventType <span class="token operator">===</span> <span class="token string">&quot;paymentWithRedirection&quot;</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>paymentEventIndex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">trackEventTiming</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">trackType</span><span class="token operator">:</span> trackTypes<span class="token punctuation">.</span><span class="token constant">TRACK_END</span><span class="token punctuation">,</span>
      <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&quot;paymentWithRedirection&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">timeStamp</span><span class="token operator">:</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>
<p><img src="https://raw.githubusercontent.com/AlbertWhite/WebPerf-with-Google-Analytics/master/images/5.png" alt=""/></p>
<p>In google analytics, we can see that from clicking on the button to redirect to the home page takes 2.3s on average.</p>
<h3>Resources</h3>
<p>Demo from <a href="https://github.com/AlbertWhite/next-learn-demo/tree/master/6-fetching-data">https://github.com/AlbertWhite/next-learn-demo/tree/master/6-fetching-data</a></p>
<p><a href="https://medium.com/@austintoddj/using-google-analytics-with-next-js-423ea2d16a98">Using Google Analytics with Next.js</a></p>
<p><a href="https://developers.google.com/analytics/devguides/collection/analyticsjs/user-timings">Track user timing</a></p>
<p><a href="https://analytics.google.com/analytics/academy/course/5/unit/1/lesson/2">google tag manager</a>: maybe we don&#x27;t need it. <a href="https://developers.google.com/gtagjs">gtag.js</a> is enough.</p>
<p><a href="https://zeit.co/docs/v2/build-step#using-environment-variables-and-secrets">Add secret in Now deployment for enviroment variables</a> Now secrets are lowercased.</p>
<p><a href="https://developers.google.com/analytics/devguides/collection/gtagjs/user-timings">Measure user timings with gtag.js</a></p></div></div><div><a href="/site-v2.0/blog/">Back to Blogs</a><span class="blog__StyledDevider-sc-1dnbuxy-2 kwpZJy">|</span><a href="/">Go to Top</a></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/analytics/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-8b843682a0a4ed3268fb.js\"],\"component---cache-caches-gatsby-plugin-offline-app-shell-js\":[\"/component---cache-caches-gatsby-plugin-offline-app-shell-js-3e77c44618267e9d1005.js\"],\"component---src-components-blog-tsx\":[\"/component---src-components-blog-tsx-1d5b1ad62b2478af715b.js\"],\"component---src-pages-404-tsx\":[\"/component---src-pages-404-tsx-527199df2f1ba2c6c5af.js\"],\"component---src-pages-about-tsx\":[\"/component---src-pages-about-tsx-a97d2cbadf143c2f8306.js\"],\"component---src-pages-code-tsx\":[\"/component---src-pages-code-tsx-c80bc752918c10741088.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-c1837cf5c64b6c07292c.js\"],\"component---src-pages-music-tsx\":[\"/component---src-pages-music-tsx-c557ef2d5dc2b54268fe.js\"],\"component---src-pages-ux-tsx\":[\"/component---src-pages-ux-tsx-f3487f8c576d9ac0f1c3.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="eb9b50ccac76a7bb2581";</script><script src="/site-v2.0/webpack-runtime-1c8e9602bf10db530e7b.js" async></script><script src="/site-v2.0/framework-2c6e23597628f64eccfb.js" async></script><script src="/site-v2.0/app-8b843682a0a4ed3268fb.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>